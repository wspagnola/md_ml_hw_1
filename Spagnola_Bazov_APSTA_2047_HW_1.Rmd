---
title: 'APSTA 2047: HW1'
author: "William Spagnola & Emanuel Bazov"
date: "9/18/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)


'
fares <- read_csv("trip_fare_8.csv")
trips <- read_csv("trip_data_8.csv")
'
```

```{r}
'
trips_hw_1  <- trips %>% filter(pickup_datetime >= ymd_hms("2013-08-15 00:00:00") 
                 & pickup_datetime < ymd_hms("2013-08-16 00:00:00"))

fares_hw_1 <- fares %>% filter(pickup_datetime >= ymd_hms("2013-08-15 00:00:00") 
                 & pickup_datetime < ymd_hms("2013-08-16 00:00:00"))


trips_hw_1 %>% arrange(desc(pickup_datetime))
trips_hw_1 %>% arrange(pickup_datetime)

fares_hw_1 %>% arrange(desc(pickup_datetime))
fares_hw_1 %>% arrange(pickup_datetime)


write_csv(x = trips_hw_1, path = "trips_hw_1.csv")
write_csv(x = fares_hw_1, path = "fares_hw_1.csv")
'
```


#Clean Data
```{r Clean}

trips_hw_1 <- read_csv("trips_hw_1.csv")



summary(trips_hw_1)


#Look at Trip Time 
trips_hw_1 %>%
      arrange(trip_time_in_secs)

#Filter Trips less than 60 seconds
trips_hw_1 <- trips_hw_1 %>% filter(trip_time_in_secs > 60)

#Generate column of trip time minutes
trips_hw_1 <- trips_hw_1 %>%
  mutate(trip_time_in_mins =  (trip_time_in_secs / 60)) 


#Generate column of trip time Hours
trips_hw_1 <- trips_hw_1 %>%
  mutate(trip_time_in_hrs =  (trip_time_in_mins / 60)) 

#Look at Max Trip Time in descending Order
trips_hw_1 %>%
      arrange(desc(trip_time_in_mins))
trips_hw_1 %>%
      arrange(desc(trip_time_in_hrs))

#Filter Trip Time to be less than or equal to 3 hours 
trips_hw_1 <- trips_hw_1 %>% 
  filter(trip_time_in_hrs  <= 3)
    
#Generate column of average speed
trips_hw_1 <- trips_hw_1 %>%
  mutate(avg_speed = trip_distance / (trip_time_in_secs / 3600)) 

#Examing Average Speed
summary(trips_hw_1$avg_speed)

#Filter Average Speed to be Less than or equal to 60
trips_hw_1 <- trips_hw_1 %>%
              filter(avg_speed <= 60)

#Filter Average Speed to be greater than or to 10
trips_hw_1 <- trips_hw_1 %>%
              filter(avg_speed >= 10)



```


##Clean Data based on Workday Length
```{r}
#Calculate Total Numbwer of Drivers
length(unique(trips_hw_1$hack_license))

#Check Shortest Work Days
trips_hw_1 %>%
  group_by(hack_license) %>%
  summarize(earliest_start= min(pickup_datetime), latest_finish = max(dropoff_datetime),
            workday_in_seconds = as.duration(latest_finish- earliest_start) ) %>%
  arrange(workday_in_seconds)


#Check Longest Work Days
trips_hw_1 %>%
  group_by(hack_license) %>%
  summarize(earliest_start= min(pickup_datetime), latest_finish = max(dropoff_datetime),
            workday_in_seconds = as.duration(latest_finish- earliest_start) ) %>%
  arrange(desc(workday_in_seconds))

#Look at people who worked more than 16 hours
trips_hw_1 %>%
  group_by(hack_license) %>%
  summarize(earliest_start= min(pickup_datetime), latest_finish = max(dropoff_datetime),
            workday_in_seconds = as.duration(latest_finish- earliest_start) ) %>%
  filter(workday_in_seconds > as.duration(16*3600) )
  
#Look at people who worked less than 1 hour
trips_hw_1 %>%
  group_by(hack_license) %>%
  summarize(earliest_start= min(pickup_datetime), latest_finish = max(dropoff_datetime),
            workday_in_seconds = as.duration(latest_finish- earliest_start) ) %>%
  filter(workday_in_seconds < as.duration(3600) )       

#Create Boxplot of Distribution of Hack licenses
trips_hw_1 %>%
  group_by(hack_license) %>%
  summarize(earliest_start= min(pickup_datetime), latest_finish = max(dropoff_datetime),
            workday_in_seconds = as.duration(latest_finish- earliest_start) ) %>%
  ggplot(aes(x=1, y= as.numeric(workday_in_seconds)/3600))  + geom_boxplot()

#Pull License Numbers of Cab Driver Who Worked at least one Hour   
at_least_1hr <- trips_hw_1 %>%
  group_by(hack_license) %>%
  summarize(earliest_start= min(pickup_datetime), latest_finish = max(dropoff_datetime),
            workday_in_seconds = as.duration(latest_finish- earliest_start) ) %>%
  filter(workday_in_seconds >= as.duration(3600) ) %>%
  pull(hack_license)


#Calculate Rows Deleted
nrow(trips_hw_1) -trips_hw_1 %>%
    filter(hack_license %in% at_least_1hr ) %>%
  nrow()

#Remove Cab Drivers who Worked less than 1 hours
trips_hw_1 <- trips_hw_1 %>%
    filter(hack_license %in% at_least_1hr )
```


#Compare Drop Off, Pick Up Date, Trip time in Sec
```{r}

#Remove Rows Where Difference between Dropoff - Pickup and trip_time in secs is greater than 1  minute
trips_hw_1 <- trips_hw_1 %>% 
mutate(trip_duration = as.duration(dropoff_datetime - pickup_datetime) ) %>%
    mutate(trip_diff = abs(trip_time_in_secs - as.numeric(trip_duration)) ) %>%
    filter(trip_diff<= 60)

```


###Check Passenger Count
```{r}
summary(trips_hw_1$passenger_count)

```
**How many people can fit into a yellow taxicab?**

*From Driver Rule 54-15(g) (in PDF): The maximum amount of passengers allowed in a yellow taxicab by law is four (4) in a four (4) passenger taxicab or five (5) passengers in a five (5) passenger taxicab, except that an additional passenger must be accepted if such passenger is under the age of seven (7) and is held on the lap of an adult passenger seated in the rear.*

SOURCE(http://www.nyc.gov/html/tlc/html/faq/faq_pass.shtml)


```{r}

fares_hw_1 <- read_csv("fares_hw_1.csv")

summary(fares_hw_1)


```


## Summary Statistics for Each Taxi Cab
```{r}
trips_hw_1 %>% 
    group_by(medallion) %>%
    summarize(total_trips = n(),
              total_passengers  = sum(passenger_count),
              total_time_with_passengers = sum(trip_time_in_hrs),
              total_distance = sum(trip_distance))

#NOTE! : Add Earnings once we Merge with fares
    
```


##Part F
```{r}
trips_hw_1 %>% 
    mutate(hour = hour(pickup_datetime)) %>%
    group_by(hack_license, hour) %>%
    summarize(total_passengers_picked_up = sum(passenger_count),
              trips_started = n() )
    
 
##NOTE!: Think about trips_started.  I think what I did works.
```



##Part F
```{r}
trips_hw_1 %>% 
    mutate(hour = hour(pickup_datetime)) %>%
    group_by(hack_license, hour) %>%
    summarize(total_time_with_passengers = sum(trip_time_in_mins))

```




